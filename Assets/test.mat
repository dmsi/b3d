# Example material file
name: ExampleMaterial 

textures: 
  0: Assets/texture_down.ppm
  1: Assets/pam_depth_4.pam

pass:
  name: test.mat/Custom/Test
  cull: ccw 
  vertex: | 
          #version 330 core

          // Input must follow the layout
          layout(location = 0) in vec3 vertex_position;
          layout(location = 1) in vec3 vertex_normal;
          layout(location = 2) in vec4 vertex_color;
          layout(location = 3) in vec2 vertex_uv;

          out VertexData {
            vec3 wpos;
            vec3 wnormal;
            vec2 uv;
            vec3 vcol;
          } OUT;

          uniform mat4 SU_PVM_MATRIX;
          uniform mat4 SU_M_MATRIX;
          uniform mat4 SU_V_MATRIX;
          uniform mat4 SU_P_MATRIX;

          void main() {
            //gl_Position = SU_PVM_MATRIX * vec4(vertex_position, 1); 
            gl_Position = SU_P_MATRIX * SU_V_MATRIX * SU_M_MATRIX * vec4(vertex_position, 1); 
            OUT.uv = vertex_uv;
            OUT.wpos = (SU_M_MATRIX * vec4(vertex_position, 1)).xyz;
            OUT.wnormal = normalize((SU_M_MATRIX * vec4(vertex_normal.xyz, 0)).xyz);
            OUT.vcol = vertex_color.rgb;
          }

  fragment: | 
          #version 330 core

          in VertexData {
            vec3 wpos;
            vec3 wnormal;
            vec2 uv;
            vec3 vcol;
          } IN;

          // Samples must follow the layout
          uniform sampler2D TEXTURE_0;
          uniform sampler2D TEXTURE_1;
          
          uniform vec3 SU_DIRECTIONAL_LIGHT_DIRECTION_0;
          uniform vec4 SU_DIRECTIONAL_LIGHT_COLOR_0;

          vec3 Lighting(vec3 normal) {
            vec3 worldSpaceLightPos = -SU_DIRECTIONAL_LIGHT_DIRECTION_0;
            vec3 light0 = normalize( worldSpaceLightPos );
            //vec3 diffuse = max(0, dot(normal, light0)) * SU_DIRECTIONAL_LIGHT_COLOR_0.rgb;
            vec3 diffuse = max(0, 1.3*dot(normal, light0)) * vec3(1,1,1);
            vec3 ambient = vec3(0, 0, 0);
            return diffuse + ambient; 
          }

          out vec3 color;
          void main () {
            //vec3 fireColor = vec3(IN.wpos.y/2+.5, 0, 0) + IN.wpos/3;
            vec3 ambient = vec3(.2, .1, .1);
            vec3 c0 = texture(TEXTURE_0, IN.uv).rgb;
            vec3 c1 = texture(TEXTURE_1, IN.uv).rgb;
            //color = (Lighting(IN.wnormal) + ambient) * c0 * c1;
            color = c0;
          }

